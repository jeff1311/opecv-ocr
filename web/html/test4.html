<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>批量身份证识别</title>
    <link rel="stylesheet" type="text/css" href="/css/loaders.css"/>
    <link rel="stylesheet" type="text/css" href="/css/ocridcard.css"/>
    <style>
        .main{
            width:1040px !important;
        }
        #select{
            margin:10px;
            width:1020px;
        }
        .idCard,.loading{
            margin:10px;
            float:left;
        }
    </style>
</head>
<body>
<div class="main">
    <input type="file" id="img" multiple="multiple">
    <button class="select" id="select">选择图片</button>
    <div id="idCard"></div>
</div>
</body>
<script type="text/javascript" src="/js/jquery-2.1.1.min.js"></script>
<script type="text/javascript">

    $('#select').click(function(){
        $('#img').click();
    })

    document.getElementById('img').onchange = function(){
        $('#idCard').html('');
        console.log(this.files.length);
        var files = this.files;
        var file = this.files[0];
        //创建FileReader
        var re = new FileReader();
        //读取文件
        re.readAsDataURL(file);
        //读取完成后显示BASE64
        re.onload = function(){
            ocr(files);
        }

    }

    function ocr(files){
        var data = new FormData();
        data.append('test',1);
        for(var i = 0;i < files.length;i ++){
            data.append('file' + i, files[i]); // file 对象
        }
        // 提交
        $.ajax({
            url: '/ocr',
            type: 'post',
            data: data,
            processData: false, // 默认 | 不处理数据
            contentType: false,// 默认 | 不设置内容类型
            dataType: 'json',
            beforeSend: function(){
                var loading = '';
                for(var i = 0;i < files.length;i ++){
                    loading += ['<div class="loading">',
                                '	<div class="line-scale">',
                                '	  <div></div>',
                                '	  <div></div>',
                                '	  <div></div>',
                                '	  <div></div>',
                                '	  <div></div>',
                                '	</div>',
                                '</div>'].join("");
                }
                $('#idCard').html(loading);
            },
            success: function(json){
                console.log(json);
                var ocrInfo = json.ocrInfo;
                var idCards = '';
                for(var i = 0;i < ocrInfo.length;i ++){
                    idCards += ['<div class="idCard">',
                                '		<div class="text">',
                                '			<div class="name">',
                                '				<div class="n">姓名</div><div class="v" id="name">' + ocrInfo[i].name + '</div>',
                                '			</div>',
                                '			<div class="gender-nation">',
                                '				<div class="n">性别</div><div class="v" id="gender">' + ocrInfo[i].gender + '</div>',
                                '				<div class="n">民族</div><div class="v" id="nation">' + ocrInfo[i].nation + '</div>',
                                '			</div>',
                                '			<div class="birth">',
                                '				<div class="n">出生</div>',
                                '				<div class="v-y" id="year">' + ocrInfo[i].year + '</div><div class="n-y">年</div>',
                                '				<div class="v-m" id="month">' + ocrInfo[i].month + '</div><div class="n-m">月</div>',
                                '				<div class="v-d" id="day">' + ocrInfo[i].day + '</div><div class="n-d">日</div>',
                                '			</div>',
                                '			<div class="address">',
                                '				<div class="n">住址</div><div class="v" id="address">' + ocrInfo[i].address + '</div>',
                                '			</div>',
                                '		</div>',
                                '		<div class="img"></div>',
                                '		<div class="code">',
                                '			<div class="n">公民身份号码</div><div class="v" id="idCode">' + ocrInfo[i].idCode + '</div>',
                                '		</div>',
                                '	</div>'].join("");
                }
                $('#idCard').html(idCards);
            }
        })
    }

</script>
<!--<script>-->

    <!--var webSocket = null;-->
    <!--var urlPrefix = location.href.split(':')[0];-->
    <!--var baseUrl = location.href.split('/html')[0].replace(urlPrefix == 'http' ? 'http' : 'https', urlPrefix == 'http' ? 'ws' : 'wss');-->
    <!--var webSocketUrl = baseUrl + '/websocket/';-->
    <!--//判断当前浏览器是否支持webSocket-->
    <!--if ('webSocket' in window) {-->
        <!--webSocket = new WebSocket(webSocketUrl);-->
    <!--} else if ('MozwebSocket' in window) {-->
        <!--webSocket = new MozWebSocket(webSocketUrl);-->
    <!--} else {-->
        <!--console.log("此浏览器不支持webSocket");-->
    <!--}-->

    <!--//连接发生错误的回调方法-->
    <!--webSocket.onerror = function () {-->
        <!--alert("webSocket连接发生错误");-->
    <!--};-->

    <!--//连接成功建立的回调方法-->
    <!--webSocket.onopen = function () {-->
        <!--console.log("webSocket连接成功");-->
    <!--}-->

    <!--//接收到消息的回调方法-->
    <!--webSocket.onmessage = function (event) {-->
        <!--//alert('签名成功！');-->
    <!--}-->

    <!--//连接关闭的回调方法-->
    <!--webSocket.onclose = function () {-->
        <!--console.log("webSocket连接关闭");-->
    <!--}-->

    <!--//监听窗口关闭事件，当窗口关闭时，主动去关闭webSocket连接，防止连接还没断开就关闭窗口，server端会抛异常。-->
    <!--window.onbeforeunload = function () {-->
        <!--webSocket.close();-->
    <!--}-->

    <!--// webSocket.send(info.STORE_FILENAME);-->

    <!--location /websocket {-->
    <!--proxy_pass https://192.168.6.237:9443;-->
    <!--proxy_http_version 1.1;-->
    <!--#proxy_connect_timeout 60s; #连接超时时间-->
    <!--proxy_read_timeout 600s; #读取超时时间-->
    <!--#proxy_send_timeout 60s; #请求超时时间-->
    <!--proxy_set_header Upgrade $http_upgrade;-->
    <!--proxy_set_header Connection "upgrade";-->
    <!--}-->

<!--</script>-->
</html>